/*
 * ExampleTypes.idl
 * 
 * IDL definitions for example data types with basic members
 * Simple types for demonstration and testing purposes
 */

module example_types {
    
    // Maximum string lengths for bounded strings
    const unsigned long MAX_ID_LENGTH = 32;
    const unsigned long MAX_NAME_LENGTH = 64;
    const unsigned long MAX_MESSAGE_LENGTH = 128;
    const unsigned long MAX_VALUE_LENGTH = 128;
    const unsigned long MAX_IMAGE_DATA_SIZE = 3145728;  // 3 MB (3 * 1024 * 1024)
    const unsigned long MAX_POINT_CLOUD_SIZE = 512000;  // 500 KB (500 * 1024)
    
    // Basic enumerations
    enum CommandType {
        START = 0,  // drop pre-ambles for better discovery performance, keeping unique across all Enums
        STOP,
        PAUSE,
        RESET,
        SHUTDOWN
    };
    
    enum SystemState {
        INIT,
        RUNNING = 0,  // use type default for common case 
        ERROR,
        RESTARTING,
        SHUTTING_DOWN
    };
    
    enum ButtonState {
        RELEASED = 0,
        PRESSED,
        HELD,
        DOUBLE_CLICK
    };
    
    /**
     * Command - Basic command structure
     */
    struct Command {
        @key string<MAX_ID_LENGTH> command_id;     // Unique command identifier
        string<MAX_ID_LENGTH> destination_id; // Target destination identifier
        CommandType command_type;                   // Type of command
        string<MAX_MESSAGE_LENGTH> message;         // Command message or description
        // unsigned long timestamp_sec;               // Command timestamp - drop in favor of metadata
        unsigned short urgent;                            // Priority value: higher = more urgent
    };
    
    /**
     * Position - Current location reporting structure
     */
    struct Position {
        @key string<MAX_ID_LENGTH> source_id;      // Source identifier
        double latitude;                            // Latitude in degrees
        double longitude;                          // Longitude in degrees
        double altitude;                           // Altitude in meters
        unsigned long timestamp_sec;              // Position timestamp
    };
    
    /**
     * State - Basic state information structure
     */
    struct State {
        @key string<MAX_ID_LENGTH> source_id;      // Source identifier
        SystemState state_value;                    // State enumeration
        string<MAX_MESSAGE_LENGTH> error_message;   // Error message or status description
    };
    
    /**
     * Button - Basic button input structure
     */
    struct Button {
        @key string<MAX_ID_LENGTH> source_id;      // Source identifier
        @key string<MAX_ID_LENGTH> button_id;      // Button identifier
        ButtonState button_state;                   // Current button state
        unsigned long press_count;                 // Total press count
        unsigned long last_press_timestamp_sec;    // Last press time
        double hold_duration_sec;                  // Hold duration for held buttons
    };
    
    /**
     * Image - Basic image data structure
     */
    struct Image {
        @key string<MAX_ID_LENGTH> image_id;       // Image identifier
        unsigned long width;                       // Image width in pixels
        unsigned long height;                      // Image height in pixels
        string<MAX_NAME_LENGTH> format;            // Image format (e.g., "RGB", "JPEG")
        sequence<octet, MAX_IMAGE_DATA_SIZE> data; // Image data bytes
    };

// consider factoring out image width+height as nested structure for reuse

    /**
     * FinalFlatImage - High-performance image structure using @final FlatData
     * @final provides maximum zero-copy performance but requires only fixed-size types
     * Uses numeric format code instead of string, and fixed-size array instead of sequence
     */
    @final
    @transfer_mode(SHMEM_REF)
    @language_binding(FLAT_DATA)
    struct FinalFlatImage {
        @key unsigned long image_id;                   // Numeric image identifier
        unsigned short width;                           // Image width in pixels
        unsigned short height;                          // Image height in pixels
        unsigned short format;                          // Format code: 0=RGB, 1=RGBA, 2=JPEG, etc.
        octet data[MAX_IMAGE_DATA_SIZE];              // Fixed-size image data array
    };

    /**
     * FinalFlatPointCloud - High-performance image structure using @final FlatData, 500 KB version
     * @final provides maximum zero-copy performance but requires only fixed-size types
     */
    @final
    @transfer_mode(SHMEM_REF)
    @language_binding(FLAT_DATA)
    struct FinalFlatPointCloud {
        @key unsigned long point_cloud_id;        // Point cloud identifier
        octet data[MAX_POINT_CLOUD_SIZE];         // Fixed-size image data array
    };

    // =========================================================================
    // ROS2-style Parameters Support
    // =========================================================================
    
    // Maximum sizes for parameter arrays
    const unsigned long MAX_PARAMETER_NAME_LENGTH = 256;
    const unsigned long MAX_PARAMETER_STRING_VALUE_LENGTH = 256;
    const unsigned long MAX_PARAMETER_ARRAY_SIZE = 64;
    const unsigned long MAX_PARAMETERS_PER_MESSAGE = 64;
    
    /**
     * ParameterType - Enum defining all supported parameter value types
     * Similar to ROS2 rcl_interfaces/msg/ParameterType
     */
    enum ParameterType {
        PARAMETER_NOT_SET = 0,
        PARAMETER_BOOL,
        PARAMETER_INTEGER,
        PARAMETER_DOUBLE,
        PARAMETER_STRING,
        PARAMETER_BYTE_ARRAY,
        PARAMETER_BOOL_ARRAY,
        PARAMETER_INTEGER_ARRAY,
        PARAMETER_DOUBLE_ARRAY,
        PARAMETER_STRING_ARRAY
    };
    
    /**
     * ParameterValue - Union holding the actual parameter value
     * Similar to ROS2 rcl_interfaces/msg/ParameterValue
     */
    @nested
    union ParameterValue switch (ParameterType) {
        case PARAMETER_BOOL:
            boolean bool_value;
        case PARAMETER_INTEGER:
            long long integer_value;
        case PARAMETER_DOUBLE:
            double double_value;
        case PARAMETER_STRING:
            string<MAX_PARAMETER_STRING_VALUE_LENGTH> string_value;
        case PARAMETER_BYTE_ARRAY:
            sequence<octet, MAX_PARAMETER_ARRAY_SIZE> byte_array_value;
        case PARAMETER_BOOL_ARRAY:
            sequence<boolean, MAX_PARAMETER_ARRAY_SIZE> bool_array_value;
        case PARAMETER_INTEGER_ARRAY:
            sequence<long long, MAX_PARAMETER_ARRAY_SIZE> integer_array_value;
        case PARAMETER_DOUBLE_ARRAY:
            sequence<double, MAX_PARAMETER_ARRAY_SIZE> double_array_value;
        case PARAMETER_STRING_ARRAY:
            sequence<string<MAX_PARAMETER_STRING_VALUE_LENGTH>, MAX_PARAMETER_ARRAY_SIZE> string_array_value;
        default:
            boolean not_set;  // Placeholder for PARAMETER_NOT_SET
    };
    
    /**
     * Parameter - Single parameter with name and value
     * Similar to ROS2 rcl_interfaces/msg/Parameter
     */
    @nested
    struct Parameter {
        string<MAX_PARAMETER_NAME_LENGTH> name;    // Parameter name (e.g., "robot.max_velocity")
        ParameterValue value;                       // Parameter value (union)
    };
    
    /**
     * ParameterEvent - Event published when parameters change
     * Similar to ROS2 rcl_interfaces/msg/ParameterEvent
     */
    struct ParameterEvent {
        @key string<MAX_ID_LENGTH> node_id;                            // Node/component identifier
        unsigned long long timestamp_ns;                                // Event timestamp in nanoseconds
        sequence<Parameter, MAX_PARAMETERS_PER_MESSAGE> new_parameters;     // Newly added parameters
        sequence<Parameter, MAX_PARAMETERS_PER_MESSAGE> changed_parameters; // Modified parameters
        sequence<Parameter, MAX_PARAMETERS_PER_MESSAGE> deleted_parameters; // Removed parameters
    };
    
    /**
     * SetParametersRequest - Request to set parameters on a node
     * For use with request/reply pattern
     */
    struct SetParametersRequest {
        @key string<MAX_ID_LENGTH> node_id;                            // Target node identifier
        uint64 request_id;                                             // Unique request ID for correlation
        sequence<Parameter, MAX_PARAMETERS_PER_MESSAGE> parameters;    // Parameters to set
    };
    
    /**
     * SetParametersResult - Result for a single parameter set operation
     */
    @nested
    struct SetParameterResult {
        boolean successful;                                             // Whether the set was successful
        string<MAX_MESSAGE_LENGTH> reason;                              // Reason for failure (if any)
    };
    
    /**
     * SetParametersResponse - Response from setting parameters
     * For use with request/reply pattern
     */
    struct SetParametersResponse {
        @key string<MAX_ID_LENGTH> node_id;                            // Node identifier
        uint64 request_id;                                             // Matches request_id from request
        sequence<SetParameterResult, MAX_PARAMETERS_PER_MESSAGE> results; // Results for each parameter
    };

    /**
     * GetParametersRequest - Request to get current parameter values from a node
     * For use with request/reply pattern
     */
    struct GetParametersRequest {
        @key string<MAX_ID_LENGTH> node_id;                            // Target node identifier
        uint64 request_id;                                             // Unique request ID for correlation
        sequence<string<MAX_NAME_LENGTH>, MAX_PARAMETERS_PER_MESSAGE> names; // Parameter names to retrieve
    };

    /**
     * GetParametersResponse - Response with current parameter values
     * For use with request/reply pattern
     */
    struct GetParametersResponse {
        @key string<MAX_ID_LENGTH> node_id;                            // Node identifier
        uint64 request_id;                                             // Matches request_id from request
        sequence<Parameter, MAX_PARAMETERS_PER_MESSAGE> parameters;    // Retrieved parameters
    };

    /**
     * ListParametersRequest - Request to list available parameters on a node
     * For use with request/reply pattern
     */
    struct ListParametersRequest {
        @key string<MAX_ID_LENGTH> node_id;                            // Target node identifier
        uint64 request_id;                                             // Unique request ID for correlation
        sequence<string<MAX_NAME_LENGTH>, 16> prefixes;                // Filter by prefix (empty = all)
        uint32 depth;                                                  // Max depth (0 = unlimited)
    };

    /**
     * ListParametersResponse - Response with parameter names
     * For use with request/reply pattern
     */
    struct ListParametersResponse {
        @key string<MAX_ID_LENGTH> node_id;                            // Node identifier
        uint64 request_id;                                             // Matches request_id from request
        sequence<string<MAX_NAME_LENGTH>, MAX_PARAMETERS_PER_MESSAGE> names; // Parameter names
    };

    
}; // namespace example_types
