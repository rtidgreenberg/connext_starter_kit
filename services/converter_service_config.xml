<?xml version="1.0" encoding="UTF-8"?>

<dds xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="../../resource/schema/rti_converter.xsd">

  <configuration_variables>

    <!-- 
        Set up default config ENV variables after 6.1.14. 
        Override with either ENV variables i.e. "export VAR=X" or command line -DVAR=X 
      -->
    <value>
      <element>
      <name>DOMAIN_ID</name>
      <value>1</value>
      </element>
      <element>
        <name>CSV_MERGE_FILES</name>
        <value>false</value>
      </element>
    </value>
  </configuration_variables>
  <!-- Available types -->
  <types />

  <!--  A definition of a Converter instance to run -->
  <converter name="json">
    <!--  Input storage settings -->
    <input_storage>
      <sqlite>
        <storage_format>XCDR_AUTO</storage_format>
        <database_dir>log_dir/xcdr</database_dir>
      </sqlite>
    </input_storage>

    <!--  Output storage settings -->
    <output_storage>
      <sqlite>
        <storage_format>JSON_SQLITE</storage_format>
        <fileset>
          <workspace_dir>converted/json</workspace_dir>
          <filename_expression>umaa.converted.db</filename_expression>
        </fileset>
      </sqlite>
    </output_storage>

    <!--  
      Domain selection: 
      Converter is not a DDS application, so this won't create a
      DDS Domain Participant, but allows you to select which domains
      to convert 
      -->
    <domain_participant name="ConverterServiceParticipant">
      <domain_id>$(DOMAIN_ID)</domain_id>
    </domain_participant>

    <session name="DefaultSession"
      default_participant_ref="ConverterServiceParticipant">
      <!-- Topics to convert in this session -->
      <topic_group name="DefaultTopicGroup">

        <!-- Convert selected topics, matching recording service -->
        <allow_topic_name_filter>Button,Command,Position</allow_topic_name_filter>
        <deny_topic_name_filter>rti/*</deny_topic_name_filter>
      </topic_group>
    </session>
  </converter>

  <!-- A definition of a Converter instance to run to output CSV -->
  <converter name="csv">
    <!-- Input storage settings -->
    <input_storage>
      <sqlite>
        <storage_format>XCDR_AUTO</storage_format>
        <database_dir>log_dir/xcdr</database_dir>
      </sqlite>
    </input_storage>

    <!--  Output storage settings -->
    <output_storage>
      <csv>
        <workspace_dir>converted/csv</workspace_dir>
        <merge_files>$(CSV_MERGE_FILES)</merge_files>
        <enum_as_string>true</enum_as_string>
      </csv>
    </output_storage>

    <!--  
      Domain selection: 
      Converter is not a DDS application, so this won't create a
      DDS Domain Participant, but allows you to select which domains
      to convert 
      -->
    <domain_participant name="ConverterServiceParticipant">
      <domain_id>$(DOMAIN_ID)</domain_id>
    </domain_participant>

    <session name="DefaultSession"
      default_participant_ref="ConverterServiceParticipant">

      <!-- Convert selected topics, matching recording service -->
      <topic_group name="DefaultTopicGroup">
        <allow_topic_name_filter>Button,Command,Position</allow_topic_name_filter>
        <deny_topic_name_filter>rti/*</deny_topic_name_filter>
      </topic_group>
    </session>
  </converter>
</dds>